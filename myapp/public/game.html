<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MasterMind</title>
    

  </head>
  <body>

    <div class = "logo">
        <img src = "images/MasterMindLogo.png">
        <h1>MasterMind</h1>
    </div>

    <div class = "stats">
        <p>Time played:     x</p>
        <p>Guesses left:    x</p>
        <p>Status: <span class = "status"></span></p>
    </div>

    
    <div class = "board">
        <div class = "rate">
            <form class = "rateGuessForm">
                <ul class = "rateGuess"></ul>
                <input type = "button" value = "Submit rating" class = "rateGuessSubmit" hidden = "true">
            </form>
        </div>
        <div class = "previousGuesses">
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
            <div class = "prevGuess">
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "hole">h</div>
                <div class = "rating">r</div>
            </div>
        </div>

        <div class = "currentGuess">
            <form class = "formGuess">
                <select id = "hole1" name = "hole1">
                    <option value = "red">          red         </option>
                    <option value = "orange">       orange      </option>
                    <option value = "yellow">       yellow      </option>
                    <option value = "green">        green       </option>
                    <option value = "lightblue">    lightblue   </option>
                    <option value = "blue">         blue        </option>
                    <option value = "purple">       purple      </option>
                    <option value = "pink">         pink        </option>
                </select>
                <select id = "hole2" name = "hole2">
                    <option value = "red">          red         </option>
                    <option value = "orange">       orange      </option>
                    <option value = "yellow">       yellow      </option>
                    <option value = "green">        green       </option>
                    <option value = "lightblue">    lightblue   </option>
                    <option value = "blue">         blue        </option>
                    <option value = "purple">       purple      </option>
                    <option value = "pink">         pink        </option>
                </select>
                <select id = "hole3" name = "hole3">
                    <option value = "red">          red         </option>
                    <option value = "orange">       orange      </option>
                    <option value = "yellow">       yellow      </option>
                    <option value = "green">        green       </option>
                    <option value = "lightblue">    lightblue   </option>
                    <option value = "blue">         blue        </option>
                    <option value = "purple">       purple      </option>
                    <option value = "pink">         pink        </option>
                </select>
                <select id = "hole4" name = "hole4">
                    <option value = "red">          red         </option>
                    <option value = "orange">       orange      </option>
                    <option value = "yellow">       yellow      </option>
                    <option value = "green">        green       </option>
                    <option value = "lightblue">    lightblue   </option>
                    <option value = "blue">         blue        </option>
                    <option value = "purple">       purple      </option>
                    <option value = "pink">         pink        </option>
                </select>
                <input type = "button" value = "Submit" class = "guessSubmit">
            </form>
        </div>
        <div class = "pins">
            <div class = "red">red</div>
            <div class = "orange">orange</div>
            <div class = "yellow">yellow</div>
            <div class = "green">green</div>
            <div class = "lightblue">lightblue</div>
            <div class = "blue">blue</div>
            <div class = "purple">purple</div>
            <div class = "pink">pink</div>
        </div>
    </div>
    
    
    <script>
        const target = document.querySelector(".status");
        const socket = new WebSocket("ws://localhost:3000");
        
        //Hides the board until the game starts.
        const board = document.querySelector(".board");
        board.hidden = true;

        document.querySelector(".guessSubmit").onclick = function() {
            //If player 2 submits their guess, puts all 4 pins into an array and sends it to the server (which sends it to player 1)
            let hole1 = document.getElementById("hole1");
            let hole2 = document.getElementById("hole2");
            let hole3 = document.getElementById("hole3");
            let hole4 = document.getElementById("hole4");
            let guess = [hole1.value, hole2.value, hole3.value, hole4.value];
            socket.send("Guess = " + guess.toString());
        }

        socket.onmessage = function(event) {
            //Update status
            target.innerHTML = event.data;

            //Does nothing yet
            let player;

            if(event.data.includes("You are player 1")){
                //If the received message contains "You are player 1", then (obviously) you are player one, this is set in the player variable.
                player = 1;
                //Hides the guessSubmit button from player 1
                document.querySelector(".guessSubmit").hidden = true;
            }            
            if(event.data.includes("You are player 2")) {
                //If the received message contains "You are player 2", then (obviously) you are player two, this is set in the player variable.
                player = 2; 
            } 

            if(event.data.includes("game is starting...")){
                //When the game starts, un-hides the board.
                board.hidden = false;
            }

            if(event.data.includes("Guess = ")){
                //If the message contains "Guess = ", then this is the guess from the other player, forwarded by the server.
                //When this happens, take the substring which is just the guess, in the shape of an array (so without "Guess = ")
                //From this string, split it into an actual array.
                let guess = event.data.substring(8); 
                let guessArray = guess.split(",");

                const rateGuess = document.querySelector(".rateGuess");
                const rateGuessForm = document.querySelector(".rateGuessForm");


                //Creates new li elements to display the guess of the other player.
                const rateGuess1 = document.createElement("li");
                const rateGuess2 = document.createElement("li");
                const rateGuess3 = document.createElement("li");
                const rateGuess4 = document.createElement("li");

                //Create select element to rate the pins.
                let select1 = document.createElement("select")
                select1.name = "rating1";
                select1.id = "rating1";

                //Add 3 options to the select element (green, yellow, red), with accompanying values (5, 1, 0 respectively).
                let option = document.createElement("option");
                option.value = "5";
                option.text = "Green";
                select1.appendChild(option);
                option = document.createElement("option");
                option.value = "1";
                option.text = "Yellow";
                select1.appendChild(option);
                option = document.createElement("option");
                option.value = "0";
                option.text = "Red";
                select1.appendChild(option);

                //Make a 3 deep copies of the select1, so we'll have 4 select items in total, one per pin. 
                let select2 = select1.cloneNode(true);
                let select3 = select1.cloneNode(true);
                let select4 = select1.cloneNode(true);

                //Display 4 li elements, with all of the 4 pins displayed in one li element per pin, and in every li element there's a select box to rate that pin
                rateGuess1.innerHTML = guessArray[0];
                rateGuess1.appendChild(select1);
                rateGuess2.innerHTML = guessArray[1];
                rateGuess2.appendChild(select2);
                rateGuess3.innerHTML = guessArray[2];
                rateGuess3.appendChild(select3);
                rateGuess4.innerHTML = guessArray[3];
                rateGuess4.appendChild(select4);

                //Add the li elements to the ul
                rateGuess.appendChild(rateGuess1);
                rateGuess.appendChild(rateGuess2);
                rateGuess.appendChild(rateGuess3);
                rateGuess.appendChild(rateGuess4);

                //Unhides the submit button, which was hidden until the guess was submitted.
                document.querySelector(".rateGuessSubmit").hidden = false;
            }
        }

        socket.onopen = function() {
            //Attempts to join a game once the connection is open.
            socket.send("Attempting to join");
            target.innerHTML = "Attempting to join...";
        }
    </script>

  </body>
</html>
